<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Minha Plataforma de Filmes</title>
  <link rel="stylesheet" href="styles.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js"></script>
</head>
<body>
  <header>
    <h1>Minha Plataforma de Filmes</h1>
    <div class="search-bar">
      <input type="text" id="search-input" placeholder="Busque filmes ou séries...">
      <button id="search-btn">Buscar</button>
      <button id="clear-btn">Limpar</button>
    </div>
  </header>
  <main>
    <section id="search-results" class="search-results hidden">
      <h2>Resultados da Busca</h2>
      <div id="results-grid" class="movies-grid"></div>
    </section>
    <section class="categories">
      <h2>Minhas Categorias</h2>
      <div id="filmes-assistidos">
        <h3>Filmes Assistidos</h3>
        <div class="movies-grid"></div>
      </div>
      <div id="filmes-para-assistir">
        <h3>Filmes para Assistir</h3>
        <div class="movies-grid"></div>
      </div>
      <div id="series-em-andamento">
        <h3>Séries em Andamento</h3>
        <div class="movies-grid"></div>
      </div>
      <div id="series-assistidas">
        <h3>Séries Assistidas</h3>
        <div class="movies-grid"></div>
      </div>
    </section>
    <section class="statistics">
      <h2>Estatísticas</h2>
      <div>
        <canvas id="seriesProgressChart"></canvas>
      </div>
      <div>
        <canvas id="watchTimeChart"></canvas>
      </div>
    </section>
  </main>
  <div id="modal" class="modal">
    <div class="modal-content">
      <span class="close">&times;</span>
      <div id="modal-details"></div>
    </div>
  </div>
  <div id="episode-details" class="episode-details hidden"></div>
  <footer>
    <p>2024 - Criado por Felipe de Oliveira Gonçalves</p>
  </footer>
  <script>
    // Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyDs877-qqhixjzOtODzNEe66zJjRgG0ho0",
      authDomain: "netflix2-40dbe.firebaseapp.com",
      projectId: "netflix2-40dbe",
      storageBucket: "netflix2-40dbe.appspot.com",
      messagingSenderId: "272948667951",
      appId: "1:272948667951:web:eb84b6fd3327eaacaa08da",
      measurementId: "G-D8ZQWFDDWT"
    };
    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    document.getElementById('search-btn').addEventListener('click', async () => {
      const query = document.getElementById('search-input').value;
      const resultsGrid = document.getElementById('results-grid');
      resultsGrid.innerHTML = '';
      const querySnapshot = await db.collection('movies').where('title', '==', query).get();
      querySnapshot.forEach((doc) => {
        const data = doc.data();
        const div = document.createElement('div');
        div.innerHTML = `
          <h3>${data.title}</h3>
          <p>${data.director}</p>
          <p>${data.releaseYear}</p>
          <button onclick="deleteMovie('${doc.id}')">Excluir</button>
        `;
        resultsGrid.appendChild(div);
      });
      document.getElementById('search-results').classList.remove('hidden');
    });

    document.getElementById('clear-btn').addEventListener('click', () => {
      document.getElementById('search-input').value = '';
      document.getElementById('results-grid').innerHTML = '';
      document.getElementById('search-results').classList.add('hidden');
    });

    async function deleteMovie(id) {
      await fetch(`/delete/${id}`, { method: 'DELETE' });
      document.getElementById('search-btn').click();
    }
  </script>
  <script src="script.js"></script>
</body>
</html>

